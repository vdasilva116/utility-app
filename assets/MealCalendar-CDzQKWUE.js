import{Q as M}from"./QInput-7YtwZLaz.js";import{Q as O}from"./QSelect-kWo_cEnn.js";import{Q as w,a as R}from"./QBtn-B5HOvfy_.js";import{Q as A}from"./QPage-DiLNYGvv.js";import{x as L,r as p,a as k,e as Y,y as r,B as y,C as $,D as i,G as u,E as m,K as z,L as f,M as g,N as x,O as C,P as J,F as E,_ as P}from"./index-mX4mPh-6.js";import"./use-key-composition-hvQkky4D.js";import"./use-dark-DzcR0PhV.js";import"./render-BPtvFS0_.js";import"./focus-manager-BJWzFvJg.js";import"./QItem-Dk3vNoqN.js";import"./format-C1kmKUJB.js";const j={class:"row q-mb-sm q-gutter-sm items-center"},G={class:"calendar-container"},H={class:"calendar-header"},W={class:"calendar-title"},X={class:"calendar-grid"},Z={class:"cell-header"},ee={class:"cell-tasks"},te=L({__name:"MealCalendar",setup(ae){const c=p({}),v=p([]),s=p(new Date),D=p(""),_=p(""),S=["LUNDI","MARDI","MERCREDI","JEUDI","VENDREDI","SAMEDI","DIMANCHE"];function d(e){return e.toISOString().split("T")[0]??""}function Q(e){const a=s.value.getMonth();return v.value.filter(t=>{const n=new Date(t.date);return t.date===e&&n.getMonth()===a})}async function V(e,a,t){const{data:{user:n}}=await r.auth.getUser();if(!n)return;const l=c.value[e]??{lunch:"",dinner:""};l[a]=t,c.value[e]=l;const{data:h}=await r.from("meals").select("id").eq("user_id",n.id).eq("date",e).maybeSingle();h?.id?await r.from("meals").update({[a]:t}).eq("id",h.id):await r.from("meals").insert({user_id:n.id,date:e,[a]:t})}async function q(){const e=D.value.trim(),a=_.value;if(!e||!a)return;const{data:{user:t}}=await r.auth.getUser();if(!t)return;const{data:n,error:l}=await r.from("tasks").insert([{user_id:t.id,date:a,content:e}]).select().single();!l&&n&&v.value.push(n),D.value="",_.value=""}async function b(e){v.value=v.value.filter(a=>a.id!==e),await r.from("tasks").delete().eq("id",e)}function N(){const e=s.value.getFullYear(),a=s.value.getMonth(),t=new Date(e,a,1),n=new Date(e,a+1,0),l=[],h=(t.getDay()+6)%7;for(let o=h;o>0;o--)l.push(new Date(e,a,1-o));for(let o=1;o<=n.getDate();o++)l.push(new Date(e,a,o));const K=(7-l.length%7)%7;for(let o=1;o<=K;o++)l.push(new Date(e,a+1,o));return l}const I=k(()=>N()),U=k(()=>s.value.toLocaleDateString("fr-FR",{month:"long"})),F=k(()=>I.value.filter(e=>e.getMonth()===s.value.getMonth()).map(e=>({label:`${e.getDate()} ${U.value}`,value:d(e)})));function T(){s.value=new Date(s.value.getFullYear(),s.value.getMonth()+1,1)}function B(){s.value=new Date(s.value.getFullYear(),s.value.getMonth()-1,1)}return Y(async()=>{const{data:{user:e}}=await r.auth.getUser();if(!e)return;const{data:a}=await r.from("meals").select("*").eq("user_id",e.id);c.value={},a?.forEach(n=>{c.value[n.date]={lunch:n.lunch||"",dinner:n.dinner||""}});const{data:t}=await r.from("tasks").select("*").eq("user_id",e.id);v.value=t??[]}),(e,a)=>(i(),y(A,{class:"q-pa-md"},{default:$(()=>[u("div",j,[m(M,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=t=>D.value=t),label:"TÃ¢che",dense:"",outlined:"",class:"col",onKeyup:z(q,["enter"])},null,8,["modelValue"]),m(O,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=t=>_.value=t),options:F.value,label:"Jour",dense:"",outlined:"",class:"col","map-options":"","emit-value":""},null,8,["modelValue","options"]),m(w,{label:"Ajouter",dense:"",color:"primary",onClick:q,class:"q-pa-sm"})]),u("div",G,[u("div",H,[m(w,{icon:"chevron_left",onClick:B,flat:""}),u("div",W,f(U.value)+" "+f(s.value.getFullYear()),1),m(w,{icon:"chevron_right",onClick:T,flat:""})]),u("div",X,[(i(),g(C,null,x(S,(t,n)=>u("div",{key:"head-"+n,class:"calendar-day-header"},f(t),1)),64)),(i(!0),g(C,null,x(I.value,(t,n)=>(i(),g("div",{key:"day-"+n,class:J(["calendar-cell",{"not-current-month":t.getMonth()!==s.value.getMonth()}])},[u("div",Z,[u("span",null,f(t.getDate()),1)]),u("div",ee,[(i(!0),g(C,null,x(Q(d(t)),l=>(i(),g("div",{key:l.id,class:"task"},[m(R,{name:"remove_circle",size:"16px",color:"negative",class:"q-mr-xs cursor-pointer",onClick:h=>b(l.id)},null,8,["onClick"]),u("span",null,f(l.content),1)]))),128))]),t.getMonth()===s.value.getMonth()?(i(),y(M,{key:0,type:"textarea",dense:"",autogrow:"","model-value":c.value[d(t)]?.lunch??"","onUpdate:modelValue":l=>V(d(t),"lunch",String(l??"")),placeholder:"Midi",class:"q-mt-xs"},null,8,["model-value","onUpdate:modelValue"])):E("",!0),t.getMonth()===s.value.getMonth()?(i(),y(M,{key:1,type:"textarea",dense:"",autogrow:"","model-value":c.value[d(t)]?.dinner??"","onUpdate:modelValue":l=>V(d(t),"dinner",String(l??"")),placeholder:"Soir",class:"q-mt-xs"},null,8,["model-value","onUpdate:modelValue"])):E("",!0)],2))),128))])])]),_:1}))}}),he=P(te,[["__scopeId","data-v-d637ff42"]]);export{he as default};
