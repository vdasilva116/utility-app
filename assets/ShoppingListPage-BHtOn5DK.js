import{Q}from"./QInput-CjFM5bCm.js";import{Q as K}from"./QCheckbox-Lswftof0.js";import{Q as m}from"./QBtn-CVP2G80N.js";import{Q as L,a as h}from"./QItem-D4r14YIk.js";import{Q as E}from"./QList-BLDohk3p.js";import{Q as R}from"./QPage-BL-E_7of.js";import{x as S,r as c,a as M,e as D,y as l,B as b,C as u,D as p,G as f,M as q,F as $,E as a,K as U,O as B,N as A,H as N,L as w,f as P,_ as F}from"./index-m_G7EGje.js";import"./use-key-composition-BXeVTENM.js";import"./use-dark-BkGNqrXl.js";import"./render-CmTqwg_I.js";import"./focus-manager-BJWzFvJg.js";const z={class:"q-mb-md row items-end q-gutter-sm sticky-bar"},G={key:0,class:"q-mb-lg"},H={key:1},O=S({__name:"ShoppingListPage",setup(J){const i=c([]),v=c(""),y=c(1),d=c(!1),C=c(null),x=c(null),g=M(()=>{const e=[],o=[];for(const t of i.value)t.promo?e.push(t):o.push(t);return{promo:e,regular:o}});function _(e){return e.charAt(0).toUpperCase()+e.slice(1)}async function k(){const e=v.value.trim();if(!e)return;const{data:{user:o}}=await l.auth.getUser();if(!o)return;const t=y.value||1,r=i.value.find(s=>s.name.toLowerCase()===e.toLowerCase()&&s.promo===d.value);if(r)r.quantity+=t,await l.from("shopping_items").update({quantity:r.quantity}).eq("id",r.id);else{const s={name:e,promo:d.value,quantity:t},{data:n}=await l.from("shopping_items").insert({...s,user_id:o.id}).select().single();n&&i.value.push(n)}d.value||P(()=>{x.value?.scrollIntoView({behavior:"smooth"})}),d.value&&P(()=>{C.value?.scrollIntoView({behavior:"smooth"})}),v.value="",y.value=1,d.value=!1}async function V(e){e.quantity++,await l.from("shopping_items").update({quantity:e.quantity}).eq("id",e.id)}async function I(e){e.quantity>1?(e.quantity--,await l.from("shopping_items").update({quantity:e.quantity}).eq("id",e.id)):(i.value=i.value.filter(o=>o.id!==e.id),await l.from("shopping_items").delete().eq("id",e.id))}async function T(){const{error:e}=await l.from("shopping_items").delete().eq("user_id",(await l.auth.getUser()).data.user?.id);if(e){console.error("Erreur suppression :",e.message),alert("Erreur lors de la suppression.");return}i.value=[]}function j(){const e=i.value.filter(n=>n.promo),o=i.value.filter(n=>!n.promo),t=e.map(n=>`- ${_(n.name)} * ${n.quantity}`).join(`
`),r=o.map(n=>`- ${_(n.name)} * ${n.quantity}`).join(`
`),s=(t?`ðŸŸ¢ En promo
`+t+`

`:"")+(r?`ðŸ”¸ Autres produits
`+r:"");navigator.clipboard.writeText(s).then(()=>{alert("Liste copiÃ©e dans le presse-papiers !")},()=>{alert("Erreur lors de la copie de la liste.")})}return D(async()=>{const{data:{user:e}}=await l.auth.getUser();if(!e)return;const{data:o,error:t}=await l.from("shopping_items").select("*").eq("user_id",e.id);!t&&o&&(i.value=o)}),(e,o)=>(p(),b(R,{class:"q-pa-md"},{default:u(()=>[f("div",z,[a(Q,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=t=>v.value=t),label:"Ajouter un produit",onKeyup:U(k,["enter"]),outlined:"",class:"col",dense:""},null,8,["modelValue"]),a(Q,{modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=t=>y.value=t),modelModifiers:{number:!0},label:"QtÃ©",type:"number",min:"1",onKeyup:U(k,["enter"]),outlined:"",dense:"",class:"col-2"},null,8,["modelValue"]),a(K,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=t=>d.value=t),label:"Promo"},null,8,["modelValue"]),a(m,{label:"Ajouter",onClick:k,color:"primary"}),a(m,{label:"Vider la liste",onClick:T,color:"negative",flat:""}),a(m,{label:"Copier la liste",onClick:j,color:"secondary",flat:""})]),f("div",{ref_key:"middleRef",ref:C,style:{height:"1px"}},null,512),g.value.promo.length?(p(),q("div",G,[o[3]||(o[3]=f("div",{class:"text-h6 q-mb-sm"},"ðŸŸ¢ En promo",-1)),a(E,{bordered:"",separator:""},{default:u(()=>[(p(!0),q(B,null,A(g.value.promo,(t,r)=>(p(),b(L,{key:"promo-"+r},{default:u(()=>[a(h,null,{default:u(()=>[N(w(_(t.name))+" x"+w(t.quantity),1)]),_:2},1024),a(h,{side:"",class:"row no-wrap items-center"},{default:u(()=>[a(m,{dense:"",flat:"",icon:"remove",onClick:s=>I(t)},null,8,["onClick"]),a(m,{dense:"",flat:"",icon:"add",onClick:s=>V(t)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):$("",!0),g.value.regular.length?(p(),q("div",H,[o[4]||(o[4]=f("div",{class:"text-h6 q-mb-sm"},"ðŸ”¸ Autres produits",-1)),a(E,{bordered:"",separator:""},{default:u(()=>[(p(!0),q(B,null,A(g.value.regular,(t,r)=>(p(),b(L,{key:"npromo-"+r},{default:u(()=>[a(h,null,{default:u(()=>[N(w(_(t.name))+" x"+w(t.quantity),1)]),_:2},1024),a(h,{side:"",class:"row no-wrap items-center"},{default:u(()=>[a(m,{dense:"",flat:"",icon:"remove",onClick:s=>I(t)},null,8,["onClick"]),a(m,{dense:"",flat:"",icon:"add",onClick:s=>V(t)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):$("",!0),f("div",{ref_key:"bottomRef",ref:x,style:{height:"1px"}},null,512)]),_:1}))}}),le=F(O,[["__scopeId","data-v-cecd4429"]]);export{le as default};
