import{Q as C}from"./QInput-sEPPzbf-.js";import{Q as K}from"./QSelect-BXFQQfbb.js";import{a as S,Q as L}from"./QBtn-BFVJIbQr.js";import{Q as O}from"./QTooltip-D7Q-VT5h.js";import{u as Y,a as J}from"./use-dark-CPCF1AuN.js";import{c as j,g as H,a as h,h as P,t as W,r as k,o as G,u as c,y as X,z as B,A as i,D as _,B as u,H as Z,I as D,J as d,K as V,L as q,C as $,E,_ as ee}from"./index-BfLcs9a9.js";import{Q as te}from"./QPage-DTaGXjfD.js";import"./use-key-composition-mMrpvGk-.js";import"./render-Ck4TSlS7.js";import"./focus-manager-BJWzFvJg.js";import"./QItem-BJr2OZ2i.js";import"./format-BhH4JUMI.js";const ae={true:"inset",item:"item-inset","item-thumbnail":"item-thumbnail-inset"},I={xs:2,sm:4,md:8,lg:16,xl:24},ne=j({name:"QSeparator",props:{...Y,spaced:[Boolean,String],inset:[Boolean,String],vertical:Boolean,color:String,size:String},setup(s){const v=H(),g=J(s,v.proxy.$q),o=h(()=>s.vertical===!0?"vertical":"horizontal"),f=h(()=>` q-separator--${o.value}`),y=h(()=>s.inset!==!1?`${f.value}-${ae[s.inset]}`:""),b=h(()=>`q-separator${f.value}${y.value}`+(s.color!==void 0?` bg-${s.color}`:"")+(g.value===!0?" q-separator--dark":"")),m=h(()=>{const p={};if(s.size!==void 0&&(p[s.vertical===!0?"width":"height"]=s.size),s.spaced!==!1){const M=s.spaced===!0?`${I.md}px`:s.spaced in I?`${I[s.spaced]}px`:s.spaced,w=s.vertical===!0?["Left","Right"]:["Top","Bottom"];p[`margin${w[0]}`]=p[`margin${w[1]}`]=M}return p});return()=>P("hr",{class:b.value,style:m.value,"aria-orientation":o.value})}}),se={class:"row q-mb-sm q-gutter-sm items-center"},oe={class:"row items-center q-mb-md justify-between"},le={class:"text-h6"},re={class:"row text-center bg-grey-3"},ie={class:"row wrap"},ce={class:"text-caption text-grey"},ue={key:0},de={key:0,class:"text-subtitle2 text-primary q-mb-xs"},me={key:0},ve={key:1},he=W({__name:"MealCalendar",setup(s){const v=k({}),g=k([]),o=k(new Date),f=k(""),y=k(""),b=["LUNDI","MARDI","MERCREDI","JEUDI","VENDREDI","SAMEDI","DIMANCHE"];function m(e){return e.toISOString().split("T")[0]??""}function p(e){return g.value.filter(a=>a.date===e)}async function M(e,a,t){const{data:{user:l}}=await c.auth.getUser();if(!l)return;const n=v.value[e]??{lunch:"",dinner:""};n[a]=t,v.value[e]=n;const{data:x}=await c.from("meals").select("id").eq("user_id",l.id).eq("date",e).maybeSingle();x?.id?await c.from("meals").update({[a]:t}).eq("id",x.id):await c.from("meals").insert({user_id:l.id,date:e,[a]:t})}async function w(){const e=f.value.trim(),a=y.value;if(!e||!a)return;const{data:{user:t}}=await c.auth.getUser();if(!t)return;const{data:l,error:n}=await c.from("tasks").insert([{user_id:t.id,date:a,content:e}]).select().single();!n&&l&&g.value.push(l),f.value="",y.value=""}async function T(e){g.value=g.value.filter(a=>a.id!==e),await c.from("tasks").delete().eq("id",e)}function z(){const e=o.value.getFullYear(),a=o.value.getMonth(),t=new Date(e,a,1),l=new Date(e,a+1,0),n=[],x=(t.getDay()+6)%7;for(let r=x;r>0;r--)n.push(new Date(e,a,1-r));for(let r=1;r<=l.getDate();r++)n.push(new Date(e,a,r));const A=(7-n.length%7)%7;for(let r=1;r<=A;r++)n.push(new Date(e,a+1,r));return n}const Q=h(()=>z()),U=h(()=>o.value.toLocaleDateString("fr-FR",{month:"long"})),N=h(()=>Q.value.filter(e=>e.getMonth()===o.value.getMonth()).map(e=>({label:`${e.getDate()} ${U.value}`,value:m(e)})));function F(){o.value=new Date(o.value.getFullYear(),o.value.getMonth()+1,1)}function R(){o.value=new Date(o.value.getFullYear(),o.value.getMonth()-1,1)}return G(async()=>{const{data:{user:e}}=await c.auth.getUser();if(!e)return;const{data:a}=await c.from("meals").select("*").eq("user_id",e.id);v.value={},a?.forEach(l=>{v.value[l.date]={lunch:l.lunch||"",dinner:l.dinner||""}});const{data:t}=await c.from("tasks").select("*").eq("user_id",e.id);g.value=t??[]}),(e,a)=>(i(),X(te,{class:"q-pa-md"},{default:B(()=>[_("div",se,[u(C,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=t=>f.value=t),label:"TÃ¢che",dense:"",outlined:"",class:"col",onKeyup:Z(w,["enter"])},null,8,["modelValue"]),u(K,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=t=>y.value=t),options:N.value,label:"Jour",dense:"",outlined:"",class:"col","map-options":"","emit-value":""},null,8,["modelValue","options"]),u(S,{label:"Ajouter",dense:"",color:"primary",onClick:w,class:"q-pa-sm"})]),_("div",oe,[u(S,{icon:"chevron_left",onClick:R,flat:""}),_("div",le,D(U.value)+" "+D(o.value.getFullYear()),1),u(S,{icon:"chevron_right",onClick:F,flat:""})]),_("div",re,[(i(),d(q,null,V(b,(t,l)=>_("div",{key:l,class:"col text-bold"},D(t),1)),64))]),_("div",ie,[(i(!0),d(q,null,V(Q.value,(t,l)=>(i(),d("div",{key:l,class:"meal-cell col-xs-12 col-sm-1 col-md-1 q-pa-sm",style:{"min-height":"190px",border:"1px solid #ccc",overflow:"hidden"}},[_("div",ce,[t.getMonth()===o.value.getMonth()?(i(),d("span",ue,D(t.getDate()),1)):$("",!0)]),p(m(t)).length?(i(),d("div",de,[(i(!0),d(q,null,V(p(m(t)),n=>(i(),d("div",{key:n.id,class:"ellipsis row items-center no-wrap",style:{"font-size":"12px"}},[u(L,{name:"remove_circle",size:"16px",color:"negative",class:"q-mr-xs cursor-pointer",onClick:x=>T(n.id)},null,8,["onClick"]),n.content.length>20?(i(),d("span",me,[u(O,{anchor:"top middle"},{default:B(()=>[E(D(n.content),1)]),_:2},1024),E(" - "+D(n.content),1)])):(i(),d("span",ve,"- "+D(n.content),1))]))),128))])):$("",!0),t.getMonth()===o.value.getMonth()?(i(),d(q,{key:1},[u(C,{type:"textarea",autogrow:"",dense:"",filled:"","model-value":v.value[m(t)]?.lunch??"","onUpdate:modelValue":n=>M(m(t),"lunch",String(n??"")),placeholder:"Midi",class:"q-mt-xs"},null,8,["model-value","onUpdate:modelValue"]),u(ne,{color:"grey-4",class:"q-my-xs"}),u(C,{type:"textarea",autogrow:"",dense:"",filled:"","model-value":v.value[m(t)]?.dinner??"","onUpdate:modelValue":n=>M(m(t),"dinner",String(n??"")),placeholder:"Soir",class:"q-mt-xs"},null,8,["model-value","onUpdate:modelValue"])],64)):$("",!0)]))),128))])]),_:1}))}}),Ce=ee(he,[["__scopeId","data-v-600e38d9"]]);export{Ce as default};
