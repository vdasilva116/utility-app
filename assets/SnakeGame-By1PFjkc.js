import{Q as D}from"./QInput-Bq9lJY3A.js";import{Q as q}from"./QBtn-DmyhQL0e.js";import{Q as T,a as B}from"./QItem-BxckNNij.js";import{Q as j}from"./QList-4kGSV8uA.js";import{Q as F}from"./QPage-BJGUdAZx.js";import{x as O,r as s,e as P,y as w,o as z,B as L,C as p,D as g,G as r,M,F as H,E as c,L as y,N as K,O as X,H as E,_ as Y}from"./index-QNXwrqQa.js";import"./use-key-composition-BoGh65O8.js";import"./use-dark-CpLH2jCY.js";import"./render-DfkqJylN.js";import"./focus-manager-BJWzFvJg.js";const J={class:"q-gutter-md row items-start justify-center"},W={class:"col-12 col-md-8 column items-center"},Z={class:"text-subtitle2 q-mb-sm"},$={class:"text-subtitle2"},ee={key:0,class:"q-mt-md text-center"},ae={class:"col-12 col-md-4"},l=20,te=O({__name:"SnakeGame",setup(le){const b=s(null),o=s(null),d=s([]),n=s("right"),f=s({x:0,y:0}),x=s(0),_=s(""),h=s(0),S=s([]),k=s(!1);let m=null,v=null;function I(){d.value=[{x:5,y:5}],n.value="right",x.value=0,_.value="",h.value=0,k.value=!1,Q(),m&&clearInterval(m),v&&clearInterval(v),m=setInterval(N,150),v=setInterval(()=>h.value++,1e3)}function Q(){f.value={x:Math.floor(Math.random()*(400/l)),y:Math.floor(Math.random()*(400/l))}}function N(){const e=d.value[0];if(!e)return;const[a,u]=[e.x,e.y],t={x:a,y:u};switch(n.value){case"up":t.y--;break;case"down":t.y++;break;case"left":t.x--;break;case"right":t.x++;break}if(t.x<0||t.x>=400/l||t.y<0||t.y>=400/l||d.value.some(A=>A.x===t.x&&A.y===t.y)){clearInterval(m),clearInterval(v),k.value=!0;return}d.value.unshift(t),t.x===f.value.x&&t.y===f.value.y?(x.value++,Q()):d.value.pop(),R()}function R(){if(o.value){o.value.clearRect(0,0,400,400),o.value.fillStyle="#4caf50";for(const e of d.value)o.value.fillRect(e.x*l,e.y*l,l-2,l-2);o.value.fillStyle="#f44336",o.value.fillRect(f.value.x*l,f.value.y*l,l-2,l-2)}}function C(e){const a=n.value;e.key==="ArrowUp"&&a!=="down"?n.value="up":e.key==="ArrowDown"&&a!=="up"?n.value="down":e.key==="ArrowLeft"&&a!=="right"?n.value="left":e.key==="ArrowRight"&&a!=="left"&&(n.value="right")}async function G(){const e=_.value.trim()||"Anonyme";if(!i.value)return;const{error:a}=await w.from("scores_snake").insert({name:e,score:x.value,time:h.value,user_id:i.value});a&&console.error("Erreur lors de l’enregistrement du score :",a),await V(),k.value=!1}async function U(){if(!i.value)return;const{error:e}=await w.from("scores_snake").delete().eq("user_id",i.value);e&&console.error("Erreur lors de la réinitialisation des scores :",e),S.value=[]}async function V(){if(!i.value)return;const{data:e,error:a}=await w.from("scores_snake").select("*").eq("user_id",i.value).order("score",{ascending:!1}).order("time",{ascending:!0}).limit(5);!a&&e&&(S.value=e)}const i=s(null);return P(async()=>{const{data:e}=await w.auth.getUser();i.value=e.user?.id||null,b.value&&(o.value=b.value.getContext("2d"),window.addEventListener("keydown",C),I(),await V())}),z(()=>{window.removeEventListener("keydown",C),m&&clearInterval(m),v&&clearInterval(v)}),(e,a)=>(g(),L(F,{class:"q-pa-md"},{default:p(()=>[r("div",J,[r("div",W,[a[2]||(a[2]=r("div",{class:"text-h5 q-mb-md text-center"},"🐍 Snake",-1)),r("canvas",{ref_key:"canvas",ref:b,width:"400",height:"400",class:"snake-canvas q-mb-md"},null,512),r("div",Z,"Score : "+y(x.value),1),r("div",$,"Temps : "+y(h.value)+"s",1),k.value?(g(),M("div",ee,[a[1]||(a[1]=r("div",{class:"text-h6 text-negative"},"💀 Partie terminée !",-1)),c(D,{modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=u=>_.value=u),label:"Votre nom",dense:"",outlined:"",class:"q-mt-sm"},null,8,["modelValue"]),c(q,{label:"Sauvegarder",color:"primary",onClick:G,class:"q-mt-sm"})])):H("",!0),c(q,{label:"Rejouer",color:"primary",class:"q-mt-md",onClick:I})]),r("div",ae,[a[3]||(a[3]=r("div",{class:"text-h6 q-mb-sm text-center"},"🏆 Meilleurs scores",-1)),c(j,{bordered:"",separator:"",class:"score-list"},{default:p(()=>[(g(!0),M(X,null,K(S.value,(u,t)=>(g(),L(T,{key:t},{default:p(()=>[c(B,null,{default:p(()=>[E(y(u.name||"Anonyme"),1)]),_:2},1024),c(B,{class:"text-right"},{default:p(()=>[E(y(u.score)+" pts - "+y(u.time)+"s",1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),c(q,{label:"Réinitialiser le classement",color:"negative",class:"q-mt-md full-width",onClick:U,flat:""})])])]),_:1}))}}),fe=Y(te,[["__scopeId","data-v-14d35a9e"]]);export{fe as default};
