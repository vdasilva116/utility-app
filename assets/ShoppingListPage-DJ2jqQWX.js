import{Q as E}from"./QInput-sEPPzbf-.js";import{Q as P}from"./QCheckbox-DKTqO6DJ.js";import{a as d}from"./QBtn-BFVJIbQr.js";import{Q as x,a as y}from"./QItem-BJr2OZ2i.js";import{Q as I}from"./QList-CDRNOqyr.js";import{Q as U}from"./QPage-DTaGXjfD.js";import{t as j,r as q,a as N,o as S,u as l,y as w,z as i,A as p,D as h,J as g,C as Q,B as o,H as T,L as V,K as L,E as $,I as _,_ as K}from"./index-BfLcs9a9.js";import"./use-key-composition-mMrpvGk-.js";import"./use-dark-CPCF1AuN.js";import"./render-Ck4TSlS7.js";import"./focus-manager-BJWzFvJg.js";const z={class:"q-mb-md row items-end q-gutter-sm"},D={key:0,class:"q-mb-lg"},F={key:1},H=j({__name:"ShoppingListPage",setup(J){const s=q([]),c=q(""),m=q(!1),f=N(()=>{const t=[],a=[];for(const e of s.value)e.promo?t.push(e):a.push(e);return{promo:t,regular:a}});function v(t){return t.charAt(0).toUpperCase()+t.slice(1)}async function C(){const t=c.value.trim();if(!t)return;const{data:{user:a}}=await l.auth.getUser();if(!a)return;const e=s.value.find(n=>n.name.toLowerCase()===t.toLowerCase()&&n.promo===m.value);if(e)e.quantity++,await l.from("shopping_items").update({quantity:e.quantity}).eq("id",e.id);else{const n={name:t,promo:m.value,quantity:1},{data:u}=await l.from("shopping_items").insert({...n,user_id:a.id}).select().single();u&&s.value.push(u)}c.value="",m.value=!1}async function k(t){t.quantity++,await l.from("shopping_items").update({quantity:t.quantity}).eq("id",t.id)}async function b(t){t.quantity>1?(t.quantity--,await l.from("shopping_items").update({quantity:t.quantity}).eq("id",t.id)):(s.value=s.value.filter(a=>a.id!==t.id),await l.from("shopping_items").delete().eq("id",t.id))}async function A(){s.value=[],await l.from("shopping_items").delete().neq("id","")}function B(){const t=s.value.filter(r=>r.promo),a=s.value.filter(r=>!r.promo),e=t.map(r=>`- ${v(r.name)} * ${r.quantity}`).join(`
`),n=a.map(r=>`- ${v(r.name)} * ${r.quantity}`).join(`
`),u=(e?`ðŸŸ¢ En promo
`+e+`

`:"")+(n?`ðŸ”¸ Autres produits
`+n:"");navigator.clipboard.writeText(u).then(()=>{alert("Liste copiÃ©e dans le presse-papiers !")},()=>{alert("Erreur lors de la copie de la liste.")})}return S(async()=>{const{data:{user:t}}=await l.auth.getUser();if(!t)return;const{data:a,error:e}=await l.from("shopping_items").select("*").eq("user_id",t.id);!e&&a&&(s.value=a)}),(t,a)=>(p(),w(U,{class:"q-pa-md"},{default:i(()=>[h("div",z,[o(E,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),label:"Ajouter un produit",onKeyup:T(C,["enter"]),outlined:"",class:"col",dense:""},null,8,["modelValue"]),o(P,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),label:"Promo"},null,8,["modelValue"]),o(d,{label:"Ajouter",onClick:C,color:"primary"}),o(d,{label:"Vider la liste",onClick:A,color:"negative",flat:""}),o(d,{label:"Copier la liste",onClick:B,color:"secondary",flat:""})]),f.value.promo.length?(p(),g("div",D,[a[2]||(a[2]=h("div",{class:"text-h6 q-mb-sm"},"ðŸŸ¢ En promo",-1)),o(I,{bordered:"",separator:""},{default:i(()=>[(p(!0),g(V,null,L(f.value.promo,(e,n)=>(p(),w(x,{key:"promo-"+n},{default:i(()=>[o(y,null,{default:i(()=>[$(_(v(e.name))+" x"+_(e.quantity),1)]),_:2},1024),o(y,{side:"",class:"row no-wrap items-center"},{default:i(()=>[o(d,{dense:"",flat:"",icon:"remove",onClick:u=>b(e)},null,8,["onClick"]),o(d,{dense:"",flat:"",icon:"add",onClick:u=>k(e)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):Q("",!0),f.value.regular.length?(p(),g("div",F,[a[3]||(a[3]=h("div",{class:"text-h6 q-mb-sm"},"ðŸ”¸ Autres produits",-1)),o(I,{bordered:"",separator:""},{default:i(()=>[(p(!0),g(V,null,L(f.value.regular,(e,n)=>(p(),w(x,{key:"npromo-"+n},{default:i(()=>[o(y,null,{default:i(()=>[$(_(v(e.name))+" x"+_(e.quantity),1)]),_:2},1024),o(y,{side:"",class:"row no-wrap items-center"},{default:i(()=>[o(d,{dense:"",flat:"",icon:"remove",onClick:u=>b(e)},null,8,["onClick"]),o(d,{dense:"",flat:"",icon:"add",onClick:u=>k(e)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):Q("",!0)]),_:1}))}}),oe=K(H,[["__scopeId","data-v-6f109a2c"]]);export{oe as default};
