import{Q}from"./QBtn-B5HOvfy_.js";import{Q as S}from"./QInput-7YtwZLaz.js";import{Q as D,a as L}from"./QItem-Dk3vNoqN.js";import{Q as T}from"./QList-DI1EW8e7.js";import{Q as j}from"./QPage-DiLNYGvv.js";import{x as F,r as v,e as O,B as M,C as p,y as c,D as d,G as n,M as y,F as P,E as u,L as x,N as B,O as E,H as V,_ as z}from"./index-mX4mPh-6.js";import"./render-BPtvFS0_.js";import"./use-key-composition-hvQkky4D.js";import"./use-dark-DzcR0PhV.js";import"./focus-manager-BJWzFvJg.js";const H={class:"column items-center col-12 col-md-8"},J={class:"row items-center justify-between full-width q-mb-sm"},K={class:"text-caption q-mb-md"},W={class:"q-mb-md"},X={class:"grid-container"},Y={key:0,class:"q-mt-md text-negative text-center"},Z={class:"col-12 col-md-4"},a=4,$=F({__name:"2048Game",setup(ee){const o=v(Array(a*a).fill(0)),_=v(0),m=v(""),w=v(!1),b=v([]);function i(t,e){return e*a+t}function q(){const t=o.value.map((r,s)=>r===0?s:-1).filter(r=>r!==-1);if(t.length===0)return;const e=t[Math.floor(Math.random()*t.length)];o.value[e]=Math.random()<.9?2:4}function g(t){const e=t.filter(r=>r!==void 0&&r!==0);for(let r=0;r<e.length-1;r++)if(e[r]!==void 0&&e[r+1]!==void 0&&e[r]===e[r+1]){const s=e[r]*2;e[r]=s,_.value+=s,e.splice(r+1,1)}return[...e,...Array(a-e.length).fill(0)]}function N(t){let e=!1;const r=[...o.value];for(let s=0;s<a;s++){const f=[];for(let l=0;l<a;l++){const h=t==="left"||t==="right"?i(l,s):i(s,l);f.push(o.value[h])}const R=t==="left"?g(f):t==="right"?g(f.reverse()).reverse():t==="up"?g(f):g(f.reverse()).reverse();for(let l=0;l<a;l++){const h=R[l],C=t==="left"||t==="right"?i(l,s):i(s,l);o.value[C]!==h&&(r[C]=h,e=!0)}}e&&(o.value=r,q(),!o.value.includes(0)&&!U()&&(w.value=!0))}function U(){for(let t=0;t<a;t++)for(let e=0;e<a;e++){const r=o.value[i(e,t)];if(e<a-1&&r===o.value[i(e+1,t)]||t<a-1&&r===o.value[i(e,t+1)])return!0}return!1}function k(){o.value=Array(a*a).fill(0),_.value=0,w.value=!1,m.value="",q(),q()}async function A(){const{data:{user:t}}=await c.auth.getUser();if(!t)return;const{data:e,error:r}=await c.from("scores_2048").select("*").eq("user_id",t.id).order("score",{ascending:!1}).limit(5);!r&&e&&(b.value=e)}async function G(){if(!m.value.trim())return;const{data:{user:t}}=await c.auth.getUser();if(!t){console.error("Utilisateur non connecté");return}const{error:e}=await c.from("scores_2048").insert({name:m.value.trim(),score:_.value,user_id:t.id});e&&console.error("Erreur d'enregistrement",e),await A(),k()}async function I(){const{error:t}=await c.from("scores_2048").delete().eq("user_id",(await c.auth.getUser()).data.user?.id);t&&console.error("Erreur suppression scores",t),b.value=[]}return O(()=>{k(),A(),window.addEventListener("keydown",t=>{w.value||["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&N(t.key.replace("Arrow","").toLowerCase())})}),(t,e)=>(d(),M(j,{class:"q-pa-md row justify-center q-gutter-lg"},{default:p(()=>[n("div",H,[n("div",J,[e[1]||(e[1]=n("div",{class:"text-h5"},"🧩 Jeu 2048",-1)),u(Q,{label:"Relancer",color:"secondary",onClick:k})]),n("div",K,"Score : "+x(_.value),1),n("div",W,[n("div",X,[(d(!0),y(E,null,B(o.value,(r,s)=>(d(),y("div",{key:s,class:"tile"},x(r||""),1))),128))])]),w.value?(d(),y("div",Y,[e[2]||(e[2]=V(" 💀 Partie terminée ! ")),u(S,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=r=>m.value=r),label:"Ton nom",class:"q-mt-md",outlined:"",dense:"",style:{"max-width":"300px"}},null,8,["modelValue"]),u(Q,{label:"Enregistrer le score",color:"primary",class:"q-mt-sm",onClick:G})])):P("",!0)]),n("div",Z,[e[3]||(e[3]=n("div",{class:"text-h6 q-mb-sm"},"🏆 Meilleurs scores",-1)),u(T,{bordered:"",separator:"",class:"q-mt-sm"},{default:p(()=>[(d(!0),y(E,null,B(b.value,(r,s)=>(d(),M(D,{key:s},{default:p(()=>[u(L,null,{default:p(()=>[V(x(r.name),1)]),_:2},1024),u(L,null,{default:p(()=>[V(x(r.score),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),u(Q,{flat:"",label:"Reset scores",color:"negative",class:"q-mt-sm full-width",onClick:I})])]),_:1}))}}),de=z($,[["__scopeId","data-v-4b58bf09"]]);export{de as default};
